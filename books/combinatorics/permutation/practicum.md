^ permutations article|theorem:permutations
^ permutationsRepeat article|theorem:permutations-repeat
^ productRule article|combinatorics/rules/product|definition:rule-of-product

@task
    title: Панель быстрого доступа
    statement: |
        На панели быстрого доступа показываются способности героя (квадраты, кроме крайнего правого), которые может использовать игрок.
        Способности можно менять местами, получая различные варинаты панели.

        @image
            src: assets/dos2-skills.jpg
            caption:
                main: Панель быстрого доступа
                secondary: "Игра \"Divinity: Original Sin 2\", Larian Studios"

        Сколько существует различных вариантов панели быстрого доступа?
    solution: |
        Всего $12$ способностей героя, которые можно расставить на $12$ мест в панели быстрого доступа.
        При таких условиях каждый вариант панели можно рассматривать как перестановку из $12$ способностей.
        Найдем количество перестановок по [формуле](^permutations):

        $$ P_{12} = 12! = 479 \ 001 \ 600 $$

        Удивительно, как тесно могут быть связаны небольшие ($12$) и огромные ($479$ миллионов) числа!
        А панель-то не такая уж и большая!
    answer: |
        $$ P_{12} = 12! = 479 \ 001 \ 600 $$

@task
    title: Неочевидное такси
    statement: |
        Компания из $7$ друзей вызвала такси-минивэн на семь пассажирских мест.
        Сколькими способами они могут разместиться внутри машины?
        А если друзей $6$?
    hint: |
        Когда друзей шестеро схитрите и добавьте как-бы седьмого друга -- пустоту.
    solution: |
        Имеем $7$ человек, которых любым способом можно рассадить на $7$ мест в машине.
        Тогда каждый вариант рассадить друзей можно рассматривать как перестановку из $7$ человек.
        Найдем количество перестановок по [формуле](^permutations):

        $$ P_7 = 7! = 5040 $$

        Если друзей шестеро, то добавим к ним еще один элемент -- пустоту, которую тоже можно "усадить" на место в машине.
        Теперь у нас вновь $7$ элементов ($6$ друзей и $1$ пустота) и $7$ мест в машине.
        Снова перестановки из $7$ элементов и по-прежнему $5040$ вариантов их "рассадить".

        Как же так?! Друзей стало меньше, а количество способов их рассадить не изменилось!
        Этот неочевидный момент можно пояснить, если взглянуть на задачу под другим углом:

        ### Решение "наоборот"

        Задачу можно решить и наоборот -- представить друзей как $7$ вакантных мест (роль $k$), которым мы назначаем $7$ сидений такси (роль $n$).

        Тогда получается $A_7^7 = 5040$ вариантов.
        В практикуме по размещениям мы [доказывали](practicum|combinatorics/arrangement|task:fate-exists) вот такое интересное равенство:

        $$ A_n^n = A_n^{n-1} $$

        Когда друзей (вакантных мест) становится $6$, мы можем использовать это равенство!

        $$ A_{7 \ мест}^{7 \ друзей} = A_{7 \ мест}^{6 \ друзей} = 5040 $$

        В чем смысл?
        А в том, что распределив $6$ мест по друзьям, последнее седьмое место **единственным** образом достается оставшемуся другу.
        Это последнее распределение не порождает новых вариантов, не влияет на количество размещений.
    answer: |
        $P_7 = 5040$ способов рассадить как семерых друзей, так и шестерых.

@task
    title: Продукт цифросодержащий
    statement: |
        Сколько пятизначных чисел содержат все цифры $1, \ 2, \ 3, \ 4, \ 5$?<br>
        А сколько содержат все цифры $0, \ 2, \ 4, \ 6, \ 8$?
    hint: |
        Смотрите решение аналогичной [задачи](article|example:number-master) из статьи.
    solution: |
        В первом вопросе нам дано $5$ цифр, из которых надо составить пятизначные числа, то есть комбинации из всех этих цифр.
        Каждое такое число это перестановка, а их число можно посчитать по [формуле](^permutations) перестановок:

        $$ P_5 = 5! = 120 $$

        Количество перестановок во втором вопросе тоже равно $120$, но среди полученных чисел есть четырехзначные, начинающиеся с $0$.
        Всего их $P_4 = 4! = 24$.
        За подробностями смотрите [пример](article|example:number-master) из статьи.
        Находим количество пятизначных чисел:

        $$ P_5 - P_4 = 5! - 4! = 120 - 24 = 96 $$
    answer: |
        Ответ на первый вопрос -- $120$, на второй -- $96$.

@task
    title: Профессиональный букмекер
    statement: |
        В соревнованиях участвуют шесть команд: $A, B, C, D, E$ и $F$.

        Сколько существует вариантов расположений команд по результатам соревнования, если точно известно, что команда $A$ не займет ни первое, ни последнее места?
    hint: |
        Найдите количество всех возможных исходов соревнований и количество исходов, которые не удовлетворяют условию.
    solution: |
        Логика решения простая: находим количество всех вариантов, потом количество вариантов, в которых команда $A$ заняла первое и последние места. Вычитаем из всех вариантов лишние. PROFIT!

        Для начала найдем количество всех возможных результатов соревнования.
        Каждый такой результат это размещение $6$ мест по $6$ названиям команд, то есть перестановка из $6$ элементов.
        Посчитаем количество этих перестановок по [формуле](^permutations):

        $$ P_6 = 6! = 720 $$

        Теперь находим количество вариантов, когда команда $A$ заняла первое место.
        Их количество равно числу перестановок из $5$ оставшихся команд по $5$ оставшимся местам:

        $$ P_5 = 5! = 120 $$

        Столько же вариантов, в которых $A$ заняла последнее место.

        Теперь просто вычитаем из всех возможных ситуаций ($720$) варианты, которые не удовлетворяют условию ($240$):

        $$ 720 - 240 = 480 $$

        ### Решение через правило умножения

        Задачу можно довольно просто решить "напрямую".
        На первое место претендуют все команды, кроме $A$, то есть $5$ команд.
        Вне зависимости от выбора команды на первое место, на последнее место можно выбрать одну из $4$ команд (все оставшиеся кроме $A$).
        Ну а далее со второго по пятое места можно выбирать любые оставшиеся команды, включая $A$:
        Используем [правило умножения](^productRule):

        $$ \underbrace{5\cdot 4}_{1 \ и \ 6 \ места} \cdot \quad \underbrace{4\cdot 3\cdot 2 \cdot 1}_{2 - 5 \ места} = 480 $$
    answer: $480$

@task
    title: Чёт и нечёт
    statement: |
        Сколько нечетных и сколько четных четырехзначных чисел можно составить из цифр числа $3694$, если каждую цифру надо использовать один раз?
    hint: |
        Число четное, если последняя его цифра четная и наоборот.
    solution: |
        Число четное, только если последняя его цифра четная, и наоброт.
        Среди данных цифр четных две ($6$ и $4$).
        Выбрав любую, оставшиеся $3$ цифры надо расставить по $3$ разрядам, а количество способов это сделать можно посчитать по [формуле](^permutations) перестановок: $P_3 = 3! = 6$.

        Итак, есть $2$ способа выбрать последнюю цифру числа.
        Вне зависимости от сделанного выбора, оставишеся разряды можно заполнить $6$ способами.
        Используем [правило умножения](^productRule):

        $$ 2 \cdot P_3 = 2 \cdot 6 = 12 $$

        Всего $12$ четных четырехзначных чисел.
        И $12$ нечетных, так как нечетных цифр тоже $2$.
    answer: Можно составить $12$ четных и $12$ нечетных четырехзначных чисел.

@task
    title: Безопасность Элли
    statement: |
        Элли придумывает секретный пароль к своему компьютеру, причем каждый символ она использует только один раз.
        Из какого минимального количества символов должен быть составлен пароль, чтобы в худшем случае взломщику пришлось перебрать не меньше $250 \ 000$ вариантов?
    hint: |

    solution: |
        Раз повторящихся элементов нет, то каждый пароль длины $k$ по сути является перестановкой из $k$ символов.
        Осталось лишь подбрать такое $k$, чтобы количество этих перестановок было не меньше миллиона.
        
        @math
            5! = 120
            \\
            6! = 720
            \\
            7! = 5040
            \\
            8! = 40 \ 320
            \\
            9! = 362 \ 880
        
        Итак, пароля из $9$ разных символов будет достаточно, чтобы Элли была спокойна.
        Жаль только она не знает, что эти $362 \ 880$ с помощью [брут-форса](article|combinatorics/brute-force|heading:brute-force) можно перебрать за пару секунд...
    answer: $9$

@task
    title: Главное — не победа, а участие
    statement: |
        В марафоне приняло участие $16$ человек, в том числе и три подруги: Катя, Женя и Настя.
        Бегут они вместе и пересекают финишную черту строго друг за другом в том порядке, в котором указаны их имена.

        Сколькими способами они могут это сделать?
        А сколько способов, если финиш они пересекают в любом порядке (но все еще друг за другом)?
    hint: |
        Найдите, сколькими способами группу из трех подруг можно расположить в таблице результатов марафона.
        Потом найдите, сколькими способами при каждом таком расположении можно разместить остальных участников марафона.
    solution: |
        У нас есть группа из трех человек, которую нужно поместить в таблицу результатов.
        В этой таблице $16$ позиций, но эту группу можно поместить только на $13$ мест -- с $1$ по $13$. На $14, 15$ и $16$ места группу поместить нельзя, иначе Женя и Настя не влезут в таблицу.

        Вне зависимости от того, каким из $13$-ти способов мы разместили группу в таблице результатов, оставшиеся $13$ мест могут занять любые остальные участники, причем сделать они это могут $P_{13} = 13!$ способами.

        По [правилу умножения](^productRule) находим все возможные способы, которыми группа из трех подруг может завершить марафон:

        $$ 13 \cdot P_{13} = 13 \cdot 13! $$ 

        Если финиш они пересекают в любом порядке, друг за другом, то нужно сначала найти все варианты составить из трех подруг группу.
        Сделать это можно $P_3 = 3! = 6$ способами.
        Дальше действия те же самые, что и для заранее заданной группы:

        $$ 6 \cdot 13 \cdot P_{13} = 78 \cdot 13! $$
    answer: |
        Финишировать именно в таком порядке подруги могут $6\cdot 13!$ способами.
        Финишировать как группа, без определенного порядка, подруги могут $78 \cdot 13!$ способами.

{ #nice-evening }
@task
    title: Званый вечер
    statement: |
        На званый вечер приглашены $5$ мужчин и $5$ женщин.
        Напротив каждого места на круглый стол необходимо поставить табличку  с именем того, кто будет на этом месте сидеть, но никакие два лица одного пола не должны сидеть рядом.
        Сколькими способами можно расставить таблички?

        А если $5$ мужчин и $5$ женщин садятся не за круглый стол, а на карусель, и способы, переходящие друг в друга при вращении карусели, считаются совпадающими?
    hint: |
        Единственный вариант рассадить участников -- чередовать мужчин и женщин.
        Сначала посадите одну женщину.
        Ее положение сразу разделит все оставшиеся стулья на "мужские" и "женские".

        В случае с каруселью помните, что она не способна поменять положение участников относительно друга друга.
    solution: |
        Раз лица одного пола не могут сидеть рядом друг с другом, то остается только вариант, когда мужчины и женщины чередуются.
        То есть стул $1$ -- мужчина, стул $2$ -- женщина, стул $3$ -- мужчина и так далее.

        Для начала выберем одну женщину и посадим ее на стул.
        Сделать это можно $10$ способами.
        Посадив эту женщину на стул, мы все оставшиеся стулья поделили на $5$ "мужских" и $4$ "женских".

        Оставшихся $4$ женщин можно рассадить только на $4$ "женских" стула.
        Каждый способ сделать это является перестановкой, а их количество равно $P_4 = 4!$.
        Мужчин же надо рассадить по $5$ "мужским" стульям и это еще $P_5 = 5!$ способов.

        Итак, первую женщину можно посадить на стул $10$ способами.
        Вне зависимости от выбранного стула, оставшихся женщин можно посадить $4!$ способами, а мужчин $5!$ способами.
        Используем [правило умножения](^productRule):

        $$ 10 \cdot 4! \cdot 5! = 28 \ 800 $$

        С каруселью алгоритм тот же самый, вот только нет никакой разницы, куда сажать первую женщину, ведь поворотом карусели ее можно сместить "на любой другой стул".
        Стало быть, $10$ вариантов посадить первую женщину превращаются всего в $1$.

        Остальные участники рассаживаются уже относительно первой женщины и друг друга, а поворот карусели не способен поменять положение участников относительно друг друга.
        Никаких изменений по этой части нет.

        $$ 1\cdot 4! \cdot 5! = 2880 $$

        Если ваша вечеринка не похожа на это, даже не пытайтесь меня приглашать...
    answer: |
        $28 \ 800$ способов, если участников рассаживать за столом и в $10$ раз меньше, $2880$, если их рассаживать за карусель.

{ #sum }
@task
    title: Комбинаторный сумматор
    statement: |
        Найдите сумму всех пятизначных чисел, которые можно записать с помощью цифр $1, \ 2, \ 3, \ 4, \ 5$ так, что в каждом числе ни одна цифра не повторяется.

        Решите ту же задачу для пятизначных чисел, которые можно записать цифрами от $1$ до $9$.
    hint: |
        Аналогичная [задача](practicum|combinatorics/arrangement|task:wonder-calc) в теме "[Размещения](article|combinatorics/arrangement)".
    solution: |
        Любые числа, например $423$ и $122$, можно записать в развернутом виде:

        $$ 423 = 400 + 20 + 3 \\ 122 = 100 + 20 + 2 $$

        Вместо того, чтобы складывать числа напрямую, можно по отдельности сложить их единицы, их десятки и их сотни.

        @math
            \begin{array}{}
                423 & = & 400 & + & 20 & + & 3
                \\
                + & & + & & + & & +
                \\
                122 & = & 100 & + & 20 & + & 2
                \\
                \shortparallel && \shortparallel && \shortparallel && \shortparallel
                \\
                545 & = & 500 & + & 40 & + & 5
            \end{array}

        Тогда задача сводится к поиску суммы всех единиц, всех десятков и всех сотен в составе этих чисел.
        То же самое справедливо и для пятизначных чисел.

        ### Пять цифр

        Начнем с разряда единиц.
        Если мы туда поставим цифру $5$, то оставшиеся $4$ цифры по оставшимся $4$ разрядам можно записать $P_4 = 4!$ способами.
        Всего $4!$ пятизначных чисел, оканчивающихся на цифру $5$.
        По такой же логике на цифру $4$ тоже оканчивается $4!$ чисел, как и на цифры $3, 2, 1$.

        Итак, на каждую из цифр от $1$ до $5$ приходится по $4!$ оканчивающихся на нее пятизначных чисел.
        Найдем сумму единиц всех этих чисел:

        $$ 4! \cdot 1 + 4! \cdot 2 + 4!\cdot 3 + 4!\cdot 4 + 4!\cdot 5 = \\ = 4!\cdot (1 + 2 + 3 + 4 + 5) = 4! \cdot 15 = \\ = 360 $$

        С разрядом десятков точно такая же ситуация.
        На каждую из цифр от $1$ до $5$ приходится по $4!$ пятизначных чисел, у которых в разряде десятков стоит выбранная цифра.
        Найдем сумму десятков всех этих чисел:

        $$ 4! \cdot 10 + 4! \cdot 20 + 4!\cdot 30 + 4!\cdot 40 + 4!\cdot 50 = \\ = 3600 $$

        По аналогии вычисляем суммы для оставшихся разрядов: $36000$ для сотен, $360000$ для тысяч и $3600000$ для десятков тысяч.
        Осталось найти общую сумму:

        $$ 360 \ 0000 + 360 \ 000 + 360 \ 00 + 360 \ 0 + 360 = 3\ 999\ 960 $$

        ### Девять цифр

        Действия точно такие же, но в этот раз по оставшимся $4$ разрядам мы записываем уже не $4$ цифры, а $8$.
        Количество способов это сделать можно посчитать по [формуле](article|combinatorics/arrangement|theorem:arrangement-unique-full) размещений без повторений:

        $$ A_8^4 = 8 \cdot 7 \cdot 6 \cdot 5 = 1680 $$

        Для единиц получаем такую сумму:

        $$ 1680 \cdot (1 + \ldots + 9) = 75600 $$

        Дальше считаем общую сумму по всем разрядам:

        $$ 75600 \ 0000 + \ldots + 75600 = 839 \ 991 \ 600 $$
    answer: |
        Сумма для пяти цифр:

        $$ 3\ 999\ 960 $$

        Сумма для девяти цифр:

        $$ 839 \ 991 \ 600 $$

{ #chess-fight }
@task
    title: Бесконтактный бой
    statement: |
        Сколькими способами можно расположить на шахматной доске $8$ ладей так, чтобы они не могли бить друг друга?

        *Ладья бьет по всей свой горизонтали и вертикали.*
    hint: |
        Используйте тот факт, что каждая ладья находится на своей вертикали и горизонтали.
    solution: |
        Если поставить ладью на одну из $8$ вертикалей, то следующую ладью придется ставить уже на другую вертикаль.
        Всего на шахматной доске $8$ вертикалей, значит каждую из них займет одна ладья.

        Выстраиваем все ладьи в ряд, занимая все $8$ ветрикалей.
        Так как все ладьи одинаковые, сделать это можно одним способом:

        @image
            src: assets/chess-begin-pos.png
            width: 300px

        Теперь надо передвинуть каждую ладью на свою горизонталь.
        Другими словами, нужно разместить $8$ ладей по $8$ горизонталям без повторений.
        Например, можно расставить их по возрастанию номера горизонтали:

        @image
            src: assets/chess-pos-variant.png
            width: 300px

        Каждое такое размещение ладей можно рассматривать как перестановку.
        Найдем количество перестановок по [формуле](^permutations):

        $$ P_8 = 8! = 40 \ 320 $$        
    answer: $40 \ 320$

@task
    title: Война бесконечности
    statement: |
        Сколькими способами на доске размером $n\times n$ можно расположить $n$ **разных** ладей?
    hint: |
        Внесите небольшое изменение в процесс решения задачи "[Бесконтактный бой](task:chess-fight)".
    solution: |
        В решении задачи "[Бесконтактный бой](task:chess-fight)" мы сначала расставили ладьи в ряд.
        Если ладьи одинаковые, то сделать это можно одним способом.
        Но в этот раз ладьи у нас разные, поэтому каждая расстановка их в ряд по сути является перестановкой из $n$ элементов.
        Количество таких перестановок находим по [формуле](^permutations):

        $$ P_n = n! $$

        Дальше, любую из этих $n!$ расстановок в ряд можно $n!$ способами раскидать по $n$ горизонталям.
        По [правилу умножения](^productRule) находим всего $n! \cdot n! = n!^2$ вариантов расположить $n$ разных ладей на доске $n \times n$.
        
        ### Решение через правило умножения

        Первую ладью можно поставить на любую из $n^2$ доступных клеток шахматной доски.
        Эта ладья бьет по своей горизонтали и вертикали, поэтому для второй ладьи доступно лишь $(n-1)$ горизонталей и $(n-1)$ вертикалей, что дает $(n-1)^2$ способов размещения.

        Продолжая эту логику дальше и используя [правило умножения](^productRule) находим все способы разместить ладьи:

        $$ n^2 \cdot (n-1)^2 \cdot (n-2)^2 \cdot \ldots \cdot 1^2 = n!^2 $$

    answer: $n!^2$

@task
    title: Комбинаторная алгебра
    statement: |
        Найти $n$:

        $$ а) \ \frac{P_{n+5}}{P_{n-k}} = 240 A_{n+3}^{k+3} \qquad б) \ (n+2)! = 132 A_n^k P_{n-k} \qquad в) \ \frac{A_{n+4}^4}{(n+2)!} < \frac{143}{4P_n} $$
    hint: |
        Пользуйтесь [формулой](^permutations) числа перестановок и факториальной [формулой](article|combinatorics/arrangement|t:arrangement-factorial) числа размещений без повторений.
    solution: |
        ### Пункт а)

        $$ \frac{P_{n+5}}{P_{n-k}} = 240 A_{n+3}^{k+3} $$

        Используем [формулу](^permutations) для числа перестановок и [факториальную](article|combinatorics/arrangement|t:arrangement-factorial) формулу числа размещений без повторений:

        @math
            \frac{(n+5)!}{(n-k)!} = 240 \frac{(n+3)!}{(n+3-(k+3))!}
            \\
            \frac{(n+5)!}{\cancel{(n-k)!}} = 240 \frac{(n+3)!}{\cancel{(n-k)!}}
            \\
            (n+5)! = 240 (n+3)!
            \\
            \frac{(n+5)!}{(n+3)!} = 240

        Для числителя несколько раз подряд используем рекуррентную [формулу](article|combinatorics/factorial|t:factorial-recurrent) факториала:

        @math
            \frac{\cancel{(n+3)!}(n+4)(n+5)}{\cancel{(n+3)!}} = 240
            \\
            (n+4)(n+5) = 240
            \\
            n^2 + 9n - 220 = 0

        Решаем это квадратное уравнение и находим два возможных значения $n$:

        $$ n_1 = -20 \qquad n_2 = 11 $$

        Значение $-20$ не подходит, потому что используемые комбинаторные понятия определены только для неотрицательных чисел.
        Другими словами, вопрос "сколько перестановок можно сделать из $-20$ элементов?" не имеет смысла.
        Поэтому остается только вариант с $n=11$.

        ### Пункт б)

        @math
            (n+2)! = 132 A_n^k P_{n-k}
        
        Используем те же самые формулы, что и в пункте а):

        @math
            (n+2)! = 132 \frac{n!}{\cancel{(n-k)!}}\cancel{(n-k)!}
            \\
            (n+2)! = 132 n!
            \\
            \frac{(n+2)!}{n!} = 132

        Для числителя два раза подряд используем рекуррентную формулу факториала:

        @math
            \frac{\cancel{n!}(n+1)(n+2)}{\cancel{n!}} = 132
            \\
            (n+1)(n+2) = 132
            \\
            n^2 + 3n - 130 = 0
            \\
            n_1 = -13 \qquad n_2 = 10

        Ответ $10$.

        ### Пункт в)

        @math
            \frac{A_{n+4}^4}{(n+2)!} < \frac{143}{4P_n}
        
        Используем те же самые формулы, что и в пункте а):

        @math
            \frac{\frac{(n+4)!}{(n+4-4)!}}{(n+2)!} < \frac{143}{4n!}
            \\
            \frac{(n+4)!}{\cancel{n!}(n+2)!} < \frac{143}{4\cancel{n!}}
            \\
            \frac{(n+4)!}{(n+2)!} < \frac{143}{4}

        Для числителя дроби слева два раза подряд используем рекуррентную формулу факториала:

        @math
            \frac{\cancel{(n+2)!}(n+3)(n+4)}{\cancel{(n+2)!}} < \frac{143}{4}
            \\
            (n+3)(n+4) < \frac{143}{4}
            \\
            4n^2 + 28n - 95 < 0
            \\
            \left(n - \frac{5}{2}\right)\left(n + \frac{19}{2}\right) < 0

        Решая по методу интервалов находим, что такому неравенству удовлетворяют все значения $n$ в следующих границах:

        $$ -\frac{19}{2} = -9.5 < n < \frac{5}{2} = 2.5 $$

        Так как $n$ -- неотрицательное целое число (иначе задача не имеет смысла), то годятся варианты $n = 0; 1; 2$.
    answer: |
        Пункт а) $11$<br>
        Пункт б) $10$<br>
        Пункт в) $0, 1, 2$

@task
    title: Фруктовые дни
    statement: |
        У мамы $2$ одинаковых яблока, $3$ одинаковых мандарина и $4$ одинаковых апельсина.
        Каждый день в течение $9$ дней подряд она выдает сыну по одному фрукту.
        Сколькими способами это может быть сделано?
    hint: |
        Используйте [формулу](^permutationsRepeat) перестановок с повторениями.
    solution: |
        $9$ фруктов, которые раздаются на протяжении $9$ дней.
        Каждый способ это сделать является перестановкой.
        Так как среди элементов есть дубликаты, то использовать надо [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ P(2, \ 3, \ 4) = \frac{9!}{2! \ 3! \ 4!} = 1260 $$
    answer: $1260$

@task
    title: Мастер анаграмм
    statement: |
        Сколько различных анаграмм можно получить, переставляя буквы слов: "ингредиент", "метаматематика", "парабола"?
    hint: |
        Используйте [формулу](^permutationsRepeat) перестановок с повторениями.
    solution: |
        Начем со слова "ингредиент".
        В нем $10$ букв, из которых надо составлять анаграммы.
        Каждую такую анаграмму можно считать за перестановку.
        Так как среди букв есть дубликаты ($2$ буквы "и", $2$ "е" и $2$ "н"), то использовать надо [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ P(2, \ 2, \ 1, \ 1, \ 2, \ 1, \ 1) = \frac{10!}{2! \ 2! \ 1! \ 1!\ 2! \ 1! \ 1!} = 453 \ 600 $$

        Анаграммы для остальных слов считаем точно так же.
        Для "метаматематики" их количество равно:

        $$ \frac{14!}{3! \ 2! \ 4! \ 3! \ 1!} = 50 \ 450 \ 400 $$

        Для "парабола":

        $$ \frac{8!}{1! \ 3! \ 1! \ 1! \ 1! \ 1!} = 6720 $$
    answer: |
        "ингредиент" -- $453 \ 600$<br>
        "метаматематика" -- $50 \ 450 \ 400$<br>
        "парабола" -- $6720$

@task
    title: Повторение повторению рознь
    statement: |
        Миша решает задачу по комбинаторике:

        *"На полке надо расставить две одинаковые книги и одну фигурку. Скольими способами это можно сделать?"*

        Он считает, что каждый вариант расставить вещи на полку можно рассматривать как размещение с повторениями из $2$ элементов (книга и фигурка) по $3$ вакантным местам и находит количество способов это сделать по [формуле](article|combinatorics/arrangement|t:arrangement-repeat):

        $$ \bar{A}_2^3 = 2^3 = 8 $$

        Правильно ли задачу решил Миша?
        Если нет, то поясните его ошибку и приведите правильное решение.
    hint: |
        Используйте важное [отличие](article|important:different-repeat).
    solution: |
        Ошибка Мишы заключается в том, что размещения с повторениями допускают неограниченное использование элементов.
        Например, в его решении допустим вариант с размещением трех одинаковых книг, хотя доступно их всего $2$, а также вариант с размещением $3$ фигурок, хотя она всего одна.
        
        Поэтому, в этой задаче надо использовать [формулу](^permutationsRepeat) перестановок с повторениями, которые [отличаются](article|important:different-repeat) от размещений с повторениями тем, что дубликаты используются ровно столько раз, сколько их есть в наличии.

        $$ P(2, \ 1) = \frac{3!}{2! \ 1!} = 3 $$
    answer: |
        $3$

@task
    title: Загадка Галилея
    statement: |
        В $1610$ году Галилей отправил Кеплеру следующую анаграмму-загадку:

        { .anagram }
        "Haec immatura a me iam frustra leguntur oy"

        Эту предложение можно перевести как "*Эти незрелые вещи пытаюсь объединить я пока что безуспешно*".
        Сколько различных анаграмм можно из нее составить?
    hint: |
        Двигайтесь слева-направо, подсчитывайте и вычеркивайте одинаковые буквы.
        Далее воспользуйтесь [формулой](^permutationsRepeat) перестановок с повторениями.
    solution: |
        Слева-направо рассматриваем каждую букву, считаем, сколько раз она повторяется в тексте и вычеркиваем ее:

        @math
            \cancel{H}\cancel{a}ec \quad imm\cancel{a}tur\cancel{a} \quad \cancel{a} \quad me \quad i\cancel{a}m \quad frustr\cancel{a} \quad leguntur \quad oy

        Буква "h" встречается один раз, можно ее не учитывать.
        Буква "a" встретилась $6$ раз.
        Вычеркиваем и подсчитываем повторящиеся буквы по такому же алгоритму и дальше, после чего используем [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ \frac{35!}{6! \ 3! \ 2! \ 4! \ 3! \ 4! \ 4!} $$
    answer: |
        $$ \frac{35!}{6! \ 3! \ 2! \ 4! \ 3! \ 4! \ 4!} $$
    note: |
        К сожалению, несчастный Кеплер и в этот раз "разгадал" анаграмму неправильно.
        У него получилось "*macula rufa in Jove est gyratur mathem*" -- "*На Юпитере есть красное пятно, вращающееся математически*".
        
        Так, очередная неверно разгаданная анаграмма Галилео оказалась предсказанием, ведь "Большое красное пятно" Юпитера действительно существует и будет открыто через $200$ лет.

        На самом деле анаграма расшифровывалась как "*Cynthiae figuras aemulatur mater amorum*" -- "*Мать любви [Венера] подражает фигурам Цинтии [Луны]*" в том смысле, что у Венеры как и у Луны есть фазы.

<style>
    .anagram {
        font-family: Noto Serif;
        font-style: italic;
        text-align: center;
        word-wrap: break-word;
    }
</style>

@task
    title: На шахматном рубеже
    statement: |
        Сколькими способами можно расставить белые фигуры (короля, ферзя, две ладьи, двух слонов и двух коней) на первой линии шахматной доски?
    hint: |
        Используйте [формулу](^permutationsRepeat) перестановок с повторениями.
    solution: |
        Каждый вариант расставить эти фигуры в линию можно рассматривать как перестановку из $8$ шахматных фигур.
        Так как некоторые фигуры имеют дубликаты, нужно использовать [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ P(1,\ 1,\ 2,\ 2,\ 2) = \frac{8!}{1! \ 1! \ 2! \ 2! \ 2!} = 5040 $$
    answer: $5040$

@task
    title: Шахматный переполох
    statement: |
        На первые две линии шахматной доски произвольным образом ставятся белые и черные фигуры (по два коня, два слона, две ладьи, ферзь и король каждого цвета).
        Сколькими способами можно это сделать?
        Сколькими способами можно расставить те же фигуры по всей доске ($8 \times 8$ полей)?
        А если расставляются и все пешки (по $8$ пешек каждого цвета)?
    hint: |
        Для ответа на первый вопрос воспользуйтесь [формулой](^permutationsRepeat) перестановок с повторениями.

        Для ответа на второй вопрос нужно помимо имеющихся фигур также рассмотреть пустые клетки как своеборазные "фигуры", которые мы тоже как-бы расставляем по полю.
        Так получится остаться в рамках перестановок.
    solution: |
        ### Две линии

        Всего $16$ фигур, которые надо расставить в $16$ клеток (это и есть две линии).
        Каждую такую расстановку можно рассматривать как перестановку.
        Так как некоторые фигуры имеют дубликаты, нужно использовать [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ \frac{16!}{\underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Белые} \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Черные}} = \frac{16!}{16}  $$

        ### Вся доска

        Этот вопрос может поставить в тупик.
        Как нам разместить $16$ фигур по $64$ клеткам?
        Если бы фигуры были уникальными, можно было бы воспользоваться [формулой](article|combinatorics/arrangement|theorem:arrangement-factorial) размещений без повторений:

        $$ A_{64}^{16} = \frac{64!}{48!} $$

        Но здесь можно провернуть хитрый финт.
        Можно добавить к $16$ фигурам $48$ пустых клетки и думать о них, как о еще $48$ повторяющихся фигурах.
        Тогда задача сводится к расстановке $64$ фигур по $64$ клеткам поля, для решения которой можно использовать [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ \frac{64!}{48! \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Белые} \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Черные}} $$

        ### Пешки

        Алгоритм точно такой же, только теперь пустых полей становится меньше, в замен которых добавляются по $8$ пешек каждого цвета.

        $$ \frac{64!}{32! \ 8! \ 8! \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Белые} \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Черные}} $$
    answer: |
        Способы расставить фигуры по двум первым линиям:

        $$ \frac{16!}{16} $$

        Способы расставить фигуры по всей доске:

        $$ \frac{64!}{48! \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Белые} \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Черные}} $$

        Способы расставить фигуры с пешками по всей доске:

        $$ \frac{64!}{32! \ 8! \ 8! \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Белые} \ \ \underbrace{1! \ 1! \ 2! \ 2! \ 2!}_{\small Черные}} $$

@task
    title: Повторяющийся сумматор
    statement: |
        Найдите сумму четырехзначных чисел, получаемых при всевозможных перестановках следующих $4$ цифр:

        $$ а) \ 1, \ 2, \ 2, \ 5 \qquad б) \ 1, \ 3, \ 3, \ 3 \qquad в) \ 1, \ 1, \ 4, \ 4 $$
    hint: |
        Решается почти так же, как и "[Комбинаторный сумматор](task:sum)", но с небольшим нюансом.
    solution: |
        ### Пункт а)

        Как и в "[Комбинаторном сумматоре](task:sum)", нам нужно отдельно сложить все единицы, десятки, сотни и тысячи.

        Начнем с единиц.
        Если в этом разряде стоит цифра $1$ или $5$, то оставшиеся три разряда можно заполнить $P(2, \ 1) = 3$ способами (две $2$ и еще одна цифра).
        Если же в этом разряде стоит цифра $2$, то оставшиеся разряды можно заполнить $P_3 = 6$ способами.
        Находим сумму всех единиц:

        $$ 3\cdot 1 + 3\cdot 5 + 6\cdot 2 = 30 $$

        С остальными разрядами подход такой же, только число нулей будет увеличиваться.
        Находим общую сумму:

        $$ 30 + 30 \ 0 + 30\ 00 + 30\ 000 = 33 \ 330 $$

        ### Пункт б)

        Решение аналогичное.
        Если в разряде единиц стоит $1$, то есть только один способ заполнить оставшиеся разряды -- записать в них тройки.
        Если в разряде единиц стоит $3$, то есть $P(2, \ 1) = 3$.
        Рассмотрим, какая сумма единиц будет в этом случае:

        $$ 1\cdot 1 + 3\cdot 3 = 10 $$

        Общая сумма:

        $$ 10 + 10 \ 0 + 10 \ 00 + 10\ 000 = 11\ 110 $$

        ### Пункт в)

        Сумма единиц:

        $$ 3\cdot 1 + 3 \cdot 4 = 15 $$

        Общая сумма:

        $$ 15 + 15 \ 0 + 15 \ 00 + 15 \ 000 = 16\ 665  $$
    answer: |
        Пункт а) $33 \ 330$<br>
        Пункт б) $11\ 110$<br>
        Пункт в) $16\ 665$<br>

{ #number-composition-strict }
@task
    title: Разложение на слагаемые
    tags:
        - Красивая
    statement: |
        Сколькими способами число $n$ можно разложить на $m$ слагаемых?
        <br>
        *Порядок слагаемых имеет значение!*
    hint: |
        Адаптируйте решение [задачи](practicum|combinatorics/arrangement|task:number-composition) о композициях числа из статьи про размещения.
    solution: |
        Самый длинный способ записать число $n$ -- представить его в виде суммы $n$ единиц:

        $$ n = \underbrace{1 + 1 + \ldots + 1}_{n \ раз} $$

        Заменим теперь в этой записи все плюсы на пустые квадраты.
        Всего этих пустых квадратов $n-1$, на единицу меньше, чем количество единиц:

        $$ n = 1 \ \Box \ 1 \ \Box \ldots \Box \ 1 \ \Box \ 1 $$

        Так как нам нужно $m$ слагаемых, то по этим квадратам мы обязаны расставить ровно $m-1$ запятых, которые разделяют слагаемые.
        В оставшиеся $(n-1)-(m-1) = n-m$ квадратов вписываем $+$.

        Например, нужно найти разложения числа $5$ ровно на $3$ слагаемых.
        Значит ищем перестановки из $3-1 = 2$ запятых и $5-3=2$ плюсов:

        @math
            \begin{align*}
                5 &= 1 + 2 + 2 = 1 \ \boxed{,} \ 1 \ \boxed{+} \ 1 \ \boxed{,} \ 1 \ \boxed{+} \ 1
                \\[10px]
                &= 2 + 1 + 2 = 1 \ \boxed{+} \ 1 \ \boxed{,} \ 1 \ \boxed{,} \ 1 \ \boxed{+} \ 1
                \\[10px]
                &= 2 + 2 + 1 = 1 \ \boxed{+} \ 1 \ \boxed{,} \ 1 \ \boxed{+} \ 1 \ \boxed{,} \ 1
                
            \end{align*}

        Так как элементы (плюсы и запятые) у нас повторяются, то количество способов разложить число $n$ на $m$ слагаемых можно найти по [формуле](^permutationsRepeat) перестановок с повторениями:

        $$ P(\underbrace{n-m}_{\text{Плюсы}}, \ \underbrace{m-1}_{\text{Запятые}}) = \frac{n!}{(n-m)! \ (m-1)!} $$
    answer: |
        $$ P(n-m, \ m-1) = \frac{n!}{(n-m)! \ (m-1)!} $$
    note: |
        Эта задача является более конкретным вариантом замечательной [задачи](practicum|combinatorics/arrangement|task:number-composition) о композициях числа.

@task
    title: Возвращение сумматора
    statement: |
        Найдите сумму всех пятизначных чисел, которые можно получить, переставляя цифры $0, \ 1, \ 2, \ 3, \ 4$ (цифра $0$ не должна быть первой).
    hint: |
        Разбейте эту задачу на две задачи поменьше.
    solution: |
        Отдельно [посчитайте сумму](task:sum) всех чисел, в том числе когда $0$ является первой цифрой.
        Отдельно посчитайте сумму четырехзначных чисел из всех данных цифр, кроме $0$.
        Вычтите из большей суммы меньшую.

        $$ 2\ 666 \ 640 - 66 \ 660 = 2 \ 599 \ 980 $$
    answer: |
        $ 2 \ 599 \ 980 $

{ #row-circle }
@task
    title: Хочешь в ряд, а хочешь в круг
    statement: |
        Имеется $5$ красных и $4$ синих шарика.
        Шарики одного цвета друг от друга ничем не отличаются.
        Сколькими способами их можно расположить в ряд?
        А если считать одинаковыми расстановки, которые можно совместить поворотами круга?
    hint: |
        Для расстановки по кругу используйте подход с шаблонами из доказательства [формулы](^permutationsRepeat) перестановок с повторениями.
        В этот раз дубликаты возникают из-за вращения круга.
    solution: |
        Каждая расстановка шариков в ряд это просто перестановка с повторениями из $9$ элементов по $9$ вакантным местам.
        Посчитаем количество таких перестановок по [формуле](^permutationsRepeat):

        $$ P(5, \ 4) = \frac{9!}{5! \ 4!} = 126 $$

        Как было $126$ способов разложить шарики в ряд, так есть и $126$ способов разложить их по кругу.
        Представим, что мы как-то разложили их по кругу.
        Так мы получили некий **шаблон**.
        Далее мы можем $8$ раз "повернуть" круг, каждый раз получая дубликат этого шаблона.
        Выходит, каждый шаблон состоит из $9$ дубликатов: $1$-го исходного положения и $8$ дубликатов, получаемых поворотом.

        @video
            src: assets/crepeat.webm
            width: 500px
            invert: light
            caption:
                main: Пример с $4$-мя элементами
                secondary: Все $4$ дубликата, составляющие $1$ уникальный шаблон

        Получается, что все $126$ вариантов разложить шарики по кругу можно разбить на шаблоны, в каждом из которых по $9$ дубликатов.
        Тогда этих самых шаблонов -- уникальных расположений шариков по кругу -- будет $126 : 9 = 14$.
    answer: |
        В ряд шарики можно разложить $126$ способами, а по кругу $14$ способами.
    note: |
        В этом решении мы буквально повторили действия из доказательства [формулы](^permutationsRepeat) перестановок с повторениями.
        Это не удивительно, ведь что там у нас возникали дубликаты комбинаций из-за повторящихся элементов, что тут возникают дубликаты комбинаций, но уже из-за вращения круга. 

        Кстати, такой же подход можно использовать и в задаче "[Званый вечер](task:nice-evening)".
        Когда мы рассаживаем гостей на карусели, у нас по-прежнему есть $10\cdot 4! \cdot 5!$ способов их рассадить.
        Но среди этих "рассадок" также можно выделить шаблоны и каждый из них будет состоять из $10$ дубликатов: исходного положения и $9$ поворотов.
        Уникальных шаблонов остается $10 \cdot 4! \cdot 5! : 10 = 4!\cdot 5!$.

@task
    title: Грань неРубика
    statement: |
        Из $9$ цветных квадратиков составили большой квадрат.
        Сколько всего можно составить больших квадратов из этих квадратиков?
        А если считать одинаковыми варианты, которые можно совместить поворотом квадрата?

        @image
            src: assets/not-rubik.svg
            width: 150px
    hint: |
        Для условия с поворотом квадрата воспользуйтесь рассуждениями из решения задачи "[Хочешь в ряд, а хочешь в круг](task:row-circle)".
    solution: |
        Каждый вариант составить большой квадрат из $9$ цветных квадратов поменьше можно рассматривать как размещение из $9$ квадратиков по $9$ вакантным местам, то есть как перестановку из $9$ элементов.
        Так как элементы у нас повтрояются, то для нахождения числа всех перестановок надо использовать [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ P(1, \ 1, \ 1, \ 2, \ 2, \ 2) = \frac{9!}{1! \ 1! \ 1! \ 2! \ 2! \ 2!} = 45 \ 360 $$

        Точно так же, как и в задаче "[Хочешь в ряд, а хочешь в круг](task:row-circle)", если допустить вращение квадрата, то среди $45 \ 360$ перестановок оказывается множество дубликатов.
        Если быть конкретнее, то каждый уникальный шаблон состоит из $4$ дубликатов: $1$-го исходного положения и $3$ поворотов на $90\degree$.

        Находим количество шаблонов, то есть уникальных перестановок:

        $$ \frac{45 \ 360}{4} = 11 \ 340 $$
    answer: |
        $45 \ 360$ вариантов составить большой квадрат и $11 \ 340$ вариантов, если допустить вращение.