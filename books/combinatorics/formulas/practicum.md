^ sumRule article|combinatorics/rules/sum|d:rule-of-sum
^ productRule article|combinatorics/rules/product|d:rule-of-product

^ arrangements article|combinatorics/arrangement|t:arrangement-unique-full

^ permutationsRepeat article|combinatorics/permutation|t:permutations-repeat

^ combinations article|combinatorics/combination|t:combinations
^ combinationsRepeat article|combinatorics/combination|t:combinations-repeat

@important
    title: Изучите основы!
    content: |
        Задачи тут более сложные!<br>
        Почти всегда в решении задействуются сразу несколько формул комбинаторики!
        
        Прежде чем решать эти задачи, убедитесь, что вы по-отдельности закрепили навыки работы с правилами [суммы](practicum|combinatorics/rules/sum) и [умножения](practicum|combinatorics/rules/product), [размещениями](practicum|combinatorics/arrangement), [перестановками](practicum|combinatorics/permutation) и [сочетаниями](practicum|combinatorics/combination).

@task
    title: Купе, в котором всем хорошо
    statement: |
        В купе железнодорожного вагона имеется два противоположных дивана по $5$ мест в каждом.
        Из $10$ пассажиров четверо желают сидеть по движению поезда, трое -- против движения, остальным трем безразлично, как сидеть.
        Сколькими способами могут разместиться пассажиры?
    hint: |
        Последовательно найдите способы рассадить жалеющих сидть по движению, потом против движения, потом безразличных.
    solution: |
        Четверо желающих сидеть по движению поезда можно расположить $A_5^4$ способами.
        Вне зависимости от их расположения, трое желающих сидеть против движения можно расположить $A_5^3$ способами.
        Троих безразличных по трем оставшимся местам в купе можно рассадить $P_3$ способами.

        Используем [правило умножения](^productRule):

        $$ A_5^4 A_5^3 P_3 = 43 \ 200 $$
    answer: $43 200$

@task
    title: Семеро одного не ждут
    statement: |
        Сколько семизначных чисел содержат ровно одну цифру $7$?
    hint: |
        Разбейте все семизначные числа на два класса: в первом числа, начинающиеся на $7$, а во втором числа, начинающиеся с любой цифры, кроме $7$.
    solution: |
        Разобьем все семизначные числа на два класса.
        
        В первом классе числа, которые начинаются на цифру $7$.
        Тогда остальные $6$ вакантых мест в шестизначном числе можно занять $9$ цифрами (все, кроме цифры $7$).
        Сделать это можно $\bar{A}_9^6$ способами.

        Во втором классе числа, которые не начинются на $7$.
        В таких числах цифру $7$ в числе можно расположить $6$-ю способами (на любое из $6$ вакантных мест).
        Первую цифру в числе можно выбрать $8$ способами (без $7$ и $0$).
        Остальные $5$ вакантных мест в числе можно занять $9$ цифрами (все, кроме $7$).
        Сделать это можно $\bar{A}_9^5$ способами.

        Так как выбор первой цифры и положение цифры $7$ не виляют на количество вариантов выбрать остальные цифры, то по правилу умножения получаем всего $6\cdot 8 \cdot \bar{A}_9^5$ чисел во втором классе.

        Классы не пересекаются, потому что в первом все числа начинаются с $7$, а во втором все числа **не начинаются** с $7$.
        Общее количество цифр находим по правилу суммы:

        $$ \bar{A}_9^6 + 6\cdot 8 \cdot \bar{A}_9^5 = 9^6 + 6\cdot 8\cdot 9^5 = 3 \ 365 \ 793 $$
    answer: $3 \ 365 \ 793$

@task
    title: Пятерка лучших!
    statement: |
        Из $12$ девушек и $10$ юношей выбирают команду в составе $5$ человек.
        Сколькими способами можно выбрать эту команду так, чтобы в нее вошло не более $3$ юношей?
    hint: |
        Сложите варианты собрать команду без юношей, с одним юношей и так далее.

        Или вычтите из всех возможных вариантов собрать команду варианты без юношей или с четырьмя юношами.
    solution: |
        ### Через сумму

        Команду только из девушек можно собрать $C_{12}^5$ способами.
        Команду из одного юноши и $4$ девушек можно собрать $C_{10}^1 C_{12}^4$ способами.
        Команду из двух юношей и $3$ девушек: $C_{10}^2 C_{12}^3$.
        Из трех юношей и двух девушек: $C_{10}^3 C_{12}^2$.

        Все $4$ группы команд не пересекаются, потому что в каждой разное количество юношей.
        Значит общее количество команд мы можем найти по [правилу суммы](^sumRule):

        $$ C_{12}^5 + C_{10}^1 C_{12}^4 + C_{10}^2 C_{12}^3 + C_{10}^3 C_{12}^2 $$

        ### Через разность

        Можно действовать "от обратного".
        Найдем сначала способы составить команду без каки-либо ограничений, то есть выбрать пятерых человек из $12 + 10 = 22$: $C_{22}^5$.

        Теперь из всех этий вариантов вычтем составы команды только из юношей и с четырьмя юношами:

        $$ C_{22}^5 - C_{10}^5 - C_{10}^4C_{12}^1 $$
    answer: |
        Через сумму:

        $$ C_{12}^5 + C_{10}^1 C_{12}^4 + C_{10}^2 C_{12}^3 + C_{10}^3 C_{12}^2 $$

        Через разность:

        $$ C_{22}^5 - C_{10}^5 - C_{10}^4C_{12}^1 $$

{ #calls }
@task
    title: Комбинаторный оператор
    statement: |
        Имеется $n$ абонентов телефонной сети.
        Сколькими способами можно одновременно соединить три пары абонентов?
    hint: |
        Найдите количество спобособов выбрать пару абонентов из $n$, потом пару из $n-2$ и так далее.
        Потом избавьтесь от дубликатов.
    solution: |
        Первую пару абонентов можно выбрать $C_n^2$ способами.
        Вторую $C_{n-2}^2$ способами, а третью $C_{n-4}^2$ способами.
        По правилу умножения находим все варианты выбрать три пары абонентов:

        $$ C_n^2 C_{n-2}^2 C_{n-4}^2 $$

        Но среди этих способов есть дубликаты.
        Например, пара абонентов $a \leftrightarrow b$ может быть выбрана во время **любого** из трех выборов пар: в $C_n^2$, в $C_{n-2}^2$ или в $C_{n-4}^2$.

        В общем случае, любые три пары абонентов могут быть выбраны в любом порядке.
        Количество разных способов выбрать $3$ пары абонентов равно $P_3$.
        Значит, каждые уникальные три пары абонентов представлены в виде $P_3$ дубликатов:

        @math
           \frac{C_n^2 C_{n-2}^2 C_{n-4}^2}{P_3} = \frac{n!}{\cancel{(n-2)!} \ 2!} \cdot \frac{\cancel{(n-2)!}}{\cancel{(n-4)!} \ 2!} \cdot \frac{\cancel{(n-4)!}}{(n-6)! \ 2!} \cdot \frac{1}{3!} = \\ = \frac{n!}{(n-6)! \cdot 8 \cdot 6} = \frac{n!}{(n-6)! \cdot 48}
    answer: |
        $$ \frac{C_n^2 C_{n-2}^2 C_{n-4}^2}{P_3} = \frac{n!}{(n-6)! \cdot 48} $$

@task
    title: Чередующиеся буквы
    statement: |
        Сколькими способами можно переставить буквы слова *"кофеварка"* так, чтобы гласные и согласные буквы чередовались?
        А в слове *"яблоко"*?
    hint: |
        Обозначьте согласные буквой "С", а гласные "Г" и составьте из этих букв "шаблон" слова.
        С его помощью посчитайте количество перестановок. 
    solution: |
        ### Кофеварка

        Пускай на первом месте в слове стоит согласная.
        Тогда получается такой "шаблон" для слова:

        $$ С \ Г \ С \ Г \ С \ Г \ С \ Г \ С $$

        Согласные по буквам "С" можно расставить $P(2,1,1,1)$ способами.
        Гласные по буквам "Г" можно расставить $P(2,1,1)$ способами.
        Расстановвка согласных никак не влияет на количество расставить гласные.
        Применяем [правило умножения](^productRule):

        $$ P_(2,1,1,1) \cdot P(2,1,1) = 720 $$

        Начать слово с гласной не выйдет, ведь в слове всего $4$ гласные, а нужно их будет пять!

        ### Яблоко

        Так как согласных и гласных букв в слове "яблоко" одинаковое количество, то будет сразу два шаблона для слов:

        $$ С \ Г \ С \ Г \ С \ Г \qquad Г \ С \ Г \ С \ Г \ С $$

        В первом шаблоне получаем $P_3\cdot P(2,1)$ слов, а во втором их столько же.
        Получили две разные группы слов.
        Находим общее их количество по [правилу суммы](^sumRule):

        $$ 2 \cdot P_3 \cdot P(2,1) = 36 $$
    answer: |
        Для слова "кофеварка" $720$ способов переставить буквы.
        Для слова "яблоко" -- $36$.

@task
    title: Квадратные треугольники
    statement: |
        Каждая сторона квадрата разбита на $n$ частей.
        Сколько можно построить треугольников с вершинами в точках деления?
    hint: |
        Найдите, сколько точек деления получается, если разделить сторону на $n$ частей.

        Потом найдите все возможные способы выбрать вершины треугольников и вычтите из них вырожденные треугольники, то есть такие, все вершины которых лежат на одной стороне.
    solution: |
        Представим прямую.
        Одна точка деления делит ее на $2$ части.
        $2$ точки деления делят ее на $3$ части.
        Значит $n-1$ точек деления делят ее на $n$ частей.

        Итак, на каждой стороне квадрата есть $n-1$ точек деления, то есть потенциальных вершин треугольников.
        Так как у квадрата $4$ стороны, то все имеем $4(n-1)$ вершин.

        Чтобы построить треугольник, нам нужно выбрать $3$ вершины из имеющихся $4(n-1)$.
        Сделать это можно $C_{4(n-1)}^3$ способами.

        Теперь из полученных способов надо вычесть вырожденные треугольники, когда все $3$ вершины взяты на одной стороне квадрата, то есть из $n-1$ вершин:

        $$ C_{4(n-1)}^3 - C_{n-1}^3 $$
    answer: |
        $$ C_{4(n-1)}^3 - C_{n-1}^3 $$

@task
    title: Вечерние танцы
    statement: |
        На школьном вечере присутствуют $12$ девушек и $15$ юношей.
        Сколькими способами можно выбрать из них $4$ пары для танца?
    hint: |
        Выберите сначала $4$ девушки, а потом $4$ парня или адаптируйте решение задачи "[Комбинаторный оператор](task:calls)".
    solution: |
        ### Через комбинаторные конфигурации

        Выбрать $4$ девушек для танцев из $12$ можно $C_{12}^4$ способами.
        Теперь каждой девушке нужно "назначить" парня.
        Порядок "назначения" уже имеет значения, поэтому сделать это можно $A_{15}^4$ способами.

        Выбор девушек никак не влияет на количество способов "назначить" парней, поэтому используем [правило умножения](^productRule):

        $$ C_{12}^4 A_{15}^4 = 16 \ 216 \ 200 $$

        ### Через правило умножения

        Представим пару как два вакантных места: одно для девушки и одно для парня.
        Для первой пары девушку можно выбрать $12$-ю способами, а парня $15$-ю.
        По [правилу умножения](^productRule) получаем $12\cdot 15$ способов составить первую пару.

        По такой же схеме, вторую пару можно составить $11\cdot 14$ способами, третью $10\cdot 13$ и четверную $9\cdot 12$.
        Составление каждой пары не меняет количество способов составить следующую пару, поэтому вновь используем правило умножения:

        $$ (12\cdot 15)\cdot(11\cdot 14)\cdot (10\cdot 13)\cdot (9\cdot 12) $$

        Как и в задаче "[Комбинаторный оператор](task:calls)", при таком составлении пар среди них есть дубликаты.
        Любые $4$ пары могут быть составлены в любом порядке, то есть $P_4$ разными способами.
        Поэтому все количество способов надо поделить на $P_4$:

        $$ \frac{(12\cdot 15)\cdot(11\cdot 14)\cdot (10\cdot 13)\cdot (9\cdot 12)}{P_4} $$
    answer: $16 \ 216 \ 200$

@task
    title: Звезда вечеринки
    statement: |
        Катя готовится посетить вечеринку. Чтобы выглядеть неотразимо, она хочет надеть на некоторые пальцы ювелирные кольца. Сколькими способами она может это сделать, если всего у нее $12$ колец, а надевать их можно на указательный, средний и безымянный пальцы каждой руки?

        *Чтобы быть неотразимой нужно надеть хотя бы одно кольцо!*
    hint: |
        Найдите количество способов выбрать $k$ пальцев, а затем количество способов найдеть на них $k$ колец.
        Подумайте, каким числам может быть равно $k$.
    solution: |
        Пускай она хочет надеть кольца на $k$ пальцев.
        Выбрать эти $k$ пальцев из $6$ можно $C_6^k$ способами.
        Далее на уже выбранных $k$ пальцах разместить $12$ колец можно $A_{12}^k$ способами.
        По [правилу умножения](^productRule) получаем всего $C_6^kA_{12}^k$ способов разместить кольца на $k$ пальцах.

        Количество пальцев с кольцами $k$ может быть от $1$ до $6$ включительно.
        Используем [правило суммы](^sumRule):

        $$ C_6^1A_{12}^1 + C_6^2A_{12}^2 + \ldots + C_6^6A_{12}^6 = \sum\limits_{k=1}^6 C_6^kA_{12}^k $$

        Если все это внимательно рассчитать и сложить, то получится $1 \ 442\ 172$.
        Как видим, у Кати есть огромное количество разных способов "нарядить" свои пальчики...
    answer: |
        $$ \sum\limits_{k=1}^6 C_6^kA_{12}^k = 1 \ 442\ 172 $$

@task
    title: Четных и нечетных пополам!
    statement: |
        Во скольких шестизначных числах есть $3$ четные и $3$ нечетные цифры, если допускаются и "шестизначные" числа, начинающиеся с нуля?
        А если не допускаются?
    hint: |
        Сначала найдите количество способов выбрать места для четных цифр.
        Потом ищите количество способов расставить четные цифры по ранее выбранным местам, а затем расставляйте нечетные цифры.

        Если ноль в начале числа не допускается, вычтите из всех полученных шестизначных чисел те, которые с начинаются с $0$.
    solution: |
        Выбрать $3$ места для четных цифр в шестизначном числе можно $C_6^3$ способами.
        По выбранным трем местам эти самые четные цифры можно разместить $\bar{A}_5^3$ способами.
        Вне зависимости от того, как мы распределили четные цифры, на оставшиеся $3$ места нечетные цифры можно расставить $\bar{A}_5^3$ способами.
        Используем [правило умножения](^productRule):

        $$ C_6^3\bar{A}_5^3\bar{A}_5^3 = 312 \ 500 $$

        Количество чисел, начинающихся с $0$ рассчитывается точно так же, только всего цифр в числе у нас уже $5$, а четных цифр будет $2$:

        $$ C_5^2\bar{A}_5^2\bar{A}_5^3 = 31 \ 250 $$

        Вычитаем из всех шестизначных чисел те, что начинаются с $0$:

        $$ 312 \ 500 - 31 \ 250 = 281 \ 250 $$

        Кстати, найти количество чисел, начинающихся на $0$ можно и другим способом.
        На первом месте может быть любая из $10$ цифр.
        Количество цифр, начинающихся на $0$ столько же, сколько чисел, начинающихся на $1$, $2$ или любую другую цифру.
        Значит, на $0$ начинается $\frac{1}{10}$ из всех шестизначных чисел:

        $$ \frac{312 \ 500}{10} = 31 \ 250 $$
    answer: |
        Всего "шестизначных" чисел:

        $$ C_6^3\bar{A}_5^3\bar{A}_5^3 = 312 \ 500 $$

        Настоящих шестизначных чисел, не начинающихся с $0$:

        $$ C_6^3\bar{A}_5^3\bar{A}_5^3 - C_5^2\bar{A}_5^2\bar{A}_5^3 = 281 \ 250 $$


{ #circus }
@task
    title: Цирковое представление
    statement: |
        Укротитель хищных зверей хочет вывести на арену цирка $5$ львов и $4$ тигров; при этом нельзя, чтобы два тигра шли друг за другом.
        Сколькими способами он может расположить зверей?
    hint: |
        Сначала расположите в ряд только львов.
        Потом посмотрите, как можно разместить тигров.
    solution: |
        Только львов в ряд можно расставить $P_5$ способами.

        Между львами есть $4$ "вакантных" места для тигров, плюс еще по месту до львов и после.
        Всего $6$ возможных положений, которые можно распределить по тиграм $A_6^4$ способами.

        Расположение львов никак не влияет на количество вариантов расположить тигров.
        Поэтому можно использовать правило умножения:

        $$ P_5 A_6^4 = 5! \cdot \frac{6!}{2!} = 43 \ 200 $$
    answer: |
        $$ P_5 A_6^4 = 43 \ 200 $$

@task
    title: Дизайнерская книжная полка
    statement: |
        На полке находятся $m + n$ различных книг, из которых $m$ в черных переплетах, а $n$ в красных.
        Сколько существует перестановок этих книг, при которых книги в черных переплетах занимают первые $m$ мест?
        Во скольких случаях все книги в черных переплетах стоят рядом (не обязательно первыми)?
    hint: |
        Сначала найдите способы расставить черные книги.
        Потом красные.
        Используйте [правило умножения](^productRule).
    solution: |
        Черные книги в начале полки можно расположить $P_m$ способами.
        Вне зависимости от того, как мы черные книги расставим, красные книги за черными можно расположить $P_n$ способами.
        По [правилу произведения](^productRule) получаем всего $P_m P_n = m!n!$ способов.

        Если черные книги стоят рядом, но не обязательно первыми, то есть $(n+1)$ способов их "пачкой" разместить где-то на книжной полке: начиная с первых мест (первый способ) и смещая вправо на одну книгу (еще $n$ способов):

        $$ (n+1) \cdot P_m P_n = m!(n+1)! $$
    answer: |
        Если черные книги стоят на первых местах:

        $$ P_mP_n = m!n! $$

        Если черные книги не обязательно на первых местах:

        $$ (n+1) \cdot P_mP_n = m!(n+1)! $$

@task
    title: Буквенные ораторы
    statement: |
        На собрании должны выступить $5$ человек: $А$, $Б$, $В$, $Г$ и $Д$.
        Сколькими способами можно расположить их в списке ораторов при условии, что $Б$ не должен выступать до того, как выступит $А$?
        А если $А$ должен выступить непосредственно перед $B$?
    hint: |
        Как вариант, можете найти варианты расставить все $5$ букв без ограничений и догадаться, сколько из них нарушают условие задачи...

        Для ответа на второй вопрос работайте с парой букв $АБ$ как с единым и неделимым целым.
    solution: |
        Сначала ответим на второй вопрос, потому что он проще.
        Если выступает сначала $А$, а потом сразу $Б$, то эту "склеенную" пару букв можно расположить в списке $4$ способами.
        При любом из этих способов оставшиеся три буквы по трем местам в списке можно расположить $P_3$ способами.
        Применяем [правило умножения](^productRule):

        $$ 4\cdot P_3 = 4! = 24 $$

        А вот к ответу на первый вопрос можно найти прийти разными путями:

        ### Через перестановки

        Без учета ограничений задачи буквы по списку можно расположить $P_5 = 5!$ способами.
        В любом способе есть буквы $А$ и $Б$. На каждый нужный нам вариант, где $А$ стоит **до** $Б$ найдется ровно один вариант, в котором эти буквы стоят **наоборот**, нарушая условие.

        Поэтому под условие задачи подходит только половина из всех $5!$ способов:

        $$ P_5 : 2 = 60 $$

        ### Через сочетания

        Всего в списке можно выбрать $C_5^2$ неупорядоченных пар мест.
        Каждую из этих пар можно представить как вариант расположения букв $А$ и $Б$.
        Оставшиеся три буквы по трем местам в списке можно расположить $P_3$ способами:

        $$ C_5^2 P_3 = 10 \cdot 6 = 60 $$

        ### Через правило суммы

        Если $А$ стоит на первом месте, то букву $Б$ можно расположить $4$ способами в списке после $А$ и еще $P_3$ способов расставить три оставшиеся буквы по трем местам.

        Если $A$ стоит на втором месте, то букву $Б$ можно расположить $3$ способами в списке после $А$ и еще $P_3$ способов расставить три оставшиеся буквы по трем местам.

        Продолжая эту логику и используя [правило сложения](^sumRule) находим все способы:

        $$ 4 \cdot P_3 + 3 \cdot P_3 + 2\cdot P_3 + 1 \cdot P_3 = P_3\cdot 10 = 60 $$
    answer: |
        $60$ способов при условии, что выступит $А$ раньше $Б$.<br>
        $24$ способа, если $Б$ выступает сразу после $А$.

@task
    title: Ограниченные слова
    statement: |
        Сколькими способами можно переставить буквы слова "перешеек" так, чтобы четыре буквы "е" не шли подряд?
    hint: |
        Найдите количество всех слов, которые можно составить из букв.
        Потом найдите количество слов с четырьмя "е" подряд.
        Ответом на задачу будет разница между двумя найденными числами.
    solution: |
        Найдем при помощи [перестановок с повторениями](^permutationsRepeat) количество всех слов, которые можно составить из этих букв:

        $$ P(4, 1, 1, 1, 1) = \frac{8!}{4! \ 1! \ 1! \ 1! \ 1!} = 1680 $$

        Четыре "склеенные" буквы "е" в восьми вакантных местах можно разместить пятью способами.
        В любом из этих способов оставшиеся четыре согласные можно разместить по четырем местам $P_4 = 4!$ способами.
        Применяем [правило умножения](^productRule):

        $$ 5 \cdot P_4 = 5! = 120 $$

        Вычитаем из всех возможных слов слова с четырьмя "е" подряд и так находим количество слов, в которых "е" не идет четыре раза подряд:

        $$ 1680 - 120 = 1560 $$
    answer: $1560$
    similar:
        -   statement: |
                Сколькими способами можно переставить буквы слова "опоссум" так, чтобы буква "п" шла непосредственно после буквы "о"?
            solution: |
                "Склеенную" пару букв "оп" в $7$ вакантных местах для букв можно разместить $6$ способами.
                Количество способов разместить остальные буквы находим по [формуле](^permutationsRepeat) перестановок с повторениями.
                Не забываем использовать [правило умножения](^productRule):

                $$ 7 \cdot P(2, 1, 1, 1) = 6\cdot \frac{5!}{2! \ 1! \ 1!} = 360 $$
            answer: $360$

{ #o-letters }
@task
    title: Новый взгляд на слова
    statement: |
        Сколькими способами можно переставить буквы слова "обороноспособность" так, чтобы две буквы "о" не шли подряд?
    hint: |
        Расставьте сначала все буквы, кроме "о".
        Потом подумайте, куда и как можно дописать "о".
    solution: |
        Для начала найдем все варианты выписать буквы вообще без "о".
        Таких букв всего $11$, а количество способов выписать их можно найти при помощи [перестановок с повторениями](^permutationsRepeat):
        
        $$ P(3, 2, 2, 1, 1, 1, 1) = \frac{11!}{3! \ 2! \ 2!} $$

        Теперь между этими буквами, а также слева и справа можно вписать ровно по одной букве "о".
        Всего $12$ вакантных мест для $7$ букв "о".
        Выбрать эти $7$ мест из $12$ для букв "о" можно с помощью [сочетаний](^combinations): $C_{12}^7$.

        Количество вариантов расставить буквы "не о" никак не влияет на количество вариантов расставить буквы "о", поэтому можно использовать [правило произведения](^productRule):

        $$ P(3,2,2,1,1,1,1) \cdot C_{12}^7 = 1 \ 317 \ 254 \ 400 $$
    answer: |
        $$ P(3,2,2,1,1,1,1) \cdot C_{12}^7 = 1 \ 317 \ 254 \ 400 $$

@task
    title: Вредные гласные
    statement: |
        Сколькими способами можно переставить буквы слова "каракули" так, чтобы никакие две гласные не стояли рядом?
    hint: |
        Повторите [решение](task:o-letters) задачи про буквы "о".
        Потом сделайте поправку на то, что гласные разные.
    solution: |
        Повторяем [решение](task:o-letters) задачи про буквы "о".
        Всего $P(2,1,1)$ способов расставить согласные и $C_{5}^4$ способов выбрать места для гласных.

        Так как гласные разные, то по выбранным $C_5^4$ местам их можно расставить $P(2,1,1)$ способами.
        Применяем [правило умножения](^productRule):

        $$ \underbrace{P(2,1,1)}_{Согласные} \cdot \underbrace{C_5^4}_{Места \ гласных} \cdot \underbrace{P(2,1,1)}_{Гласные} = 12 \cdot 5 \cdot 12 = 720 $$
    answer: |
        $$ P(2,1,1) \cdot C_5^4 \cdot P(2,1,1) = 720 $$

@task
    title: Кручу, верчу, запутать хочу
    statement: |
        На окружности отмечено $n$ точек.
        Сколько существует различных многоугольников (необязательно выпуклых), вписанных в эту окружность, вершинами которых служат данные точки? А сколько выпуклых многоугольников?
    solution: |
        Пронумеруем все точки натуральными числами от $1$ до $n$.
        Тогда любой многоугольник с вершинами в этих точках можно представить как набор чисел:

        $$ 123 \qquad 1493n \qquad \ldots $$

        Количество всех $k$-угольников находим по [формуле](^arrangements) размещений без повторений.
        Оно равно $A_n^k$.
        Но среди этих размещений есть множество дубликатов.

        Во-первых, начать перечислять $k$ вершин $k$-угольника можно с любой вершины.
        Наборы вершин $123$, $231$ и $312$ обозначают один и тот же многоугольник, просто в первом случае его начали строить с вершины $1$, во втором с $2$, а в третьем с $3$.

        Всего таких, как их называют, "циклических перестановок", $k$ штук, потому что начать строить можно с любой из $k$ вершин.
        Каждый $k$-угольник имеет $k$ таких дубликатов, поэтому общее количество $A_n^k$ надо поделить на $k$:

        $$ \frac{1}{k}A_n^k $$

        Во-вторых, каждый набор чисел можно перечислить "в обратном" порядке.
        Наборы $1234$ и $4321$ обозначают один и тот же многоугольник.
        Такой "обратный" дубликат имеет каждый $k$-угольник, поэтому общее количество надо поделить на $2$:

        $$ \frac{1}{2k}A_n^k $$

        $k$ в нашей формуле количества $k$-угольников может быть любым числом начиная с $3$ (треугольники) и заканчивая $n$ ($n$-угольники).
        По [правилу суммы](^sumRule) находим количество всех возможных многоугольников:

        $$ \frac{1}{2\cdot 3}A_n^3 + \frac{1}{2\cdot 4}A_n^4 + \ldots = \sum\limits_{k=3}^n \frac{1}{2k}A_n^k $$

        Из всех $A_n^k$ размещений вершин в разном порядке выпуклый $k$-угольник получится только если вершины перечислять строго по возрастанию.
        Например: $1234$ -- выпуклый, а $1324$ -- невыпуклый.
        Сделать это можно одним способом, поэтому вместо размещений используем [сочетания](^combinations): $C_n^k$.
        С дубликатами история точно такая же.
        В итоге получаем количество всех возможных выпуклых многоугольников:

        $$ \sum\limits_{k=3}^n \frac{1}{2k} C_n^k $$
    answer: |
        Количество всех возможных многоугольников:

        $$ \sum\limits_{k=3}^n \frac{1}{2k}A_n^k $$

        Количество выпуклых многоугольников:

        $$ \sum\limits_{k=3}^n \frac{1}{2k} C_n^k $$

{ #random-schedule }
@task
    title: Потехе время, а делу час!
    tags:
        - Важная
        - Красивая
        - Необычная
    statement: |
        Жанна в течении месяца должна проработать ровно $5$ дней.
        После каждого рабочего дня она отдыхает не менее $4$ дней.
        Сколькими способами можно выбрать рабочие дни Жанны в течении месяца?
    hint: |
        Выбирать рабочие дни надо из дней, которые не заняты отдыхом.
    solution: |
        После каждого рабочего дня Жанна отдыхает минимум $4$ дня.
        Значит в месяц Жанна **обязательно** должна отдыхать $5 \cdot 4 = 20$ дней.

        В месяце $30$ дней, причем какие-нибудь $20$ из них мы трогать не можем, они заняты отдыхом.
        Тогда выбрать $5$ рабочих дней можно только из $30 - 20 = 10$ дней.
        Сделать это можно $C_{10}^5$ способами.
    answer: $C_{10}^5 = 252$
    note: |
        Эта задача является красивой иллюстрацией получения правильного ответа без какого-либо "моделирования" возможных расписаний -- чисто из комбинаторных соображений.

        Да, мы получили верный ответ -- $252$ возможных расписания.
        Но вот перечислить их задача уже нетрививальная.
    similar:
        -   statement: |
                На книжной полке стоит $n$ книг.
                Сколькими способами можно выбрать из них $k$ книг так, чтобы между любыми двумя выбранными книгами, равно как и после $k$-й выбранной книги, было не менее $s$ книг?
            solution: |
                Каждая выбранная книга требует блока из как минимум $s$ книг сразу после себя.
                Значит $k$ выборов потребуют $k$ блоков из как минимум $s$ книг.
                
                Другими словами, как минимум $ks$ книг должны остаться нетронутыми, чтобы заполнять пространство между выбранными книгами:

                Поэтому всего для выбора доступно $n-ks$ книг, из которых мы выбираем $k$ книг:

                $$ C_{n-ks}^k $$
            answer: $C_{n-ks}^k$

        -   statement: |
                В ряд расположены $m$ предметов.
                Сколькими способами можно выбрать из них три предмета так, чтобы не брать двух рядом стоящих предметов?
            answer: $C_{m-2}^3$

        -   statement: |
                Планируется провести испытания нового лекарства.
                В течение $n$ дней надо сделать $k$ инъекций с перерывами на рекласкацию после каждой не менее чем на $s$ дней.
                Сколькими способами можно спланировать серию испытаний со случайным расписанием инъекций?
            answer: $C_{n-ks}^k$

{ #knights }
@task
    title: Рыцари короля Артура
    tags:
        - Важная
        - Красивая
        - Необычная
    statement: |
        За круглым столом короля Артура сидят $12$ рыцарей.
        Из них каждый враждует со своими соседями (и только с ними).
        Надо выбрать $5$ рыцарей, чтобы освободить заколдованную принцессу, но среди выбранных рыцарей не должно быть врагов.
        Сколькими способами это можно сделать?
    hint: |
        Выберите одного рыцаря и посмотрите, сколькими способами можно выбрать оставшихся $4$-х.
        
        Еще можете выделить одного рыцаря, назвать его $A$ и рассмотреть два класса: отряды с рыцарем $A$ и отряды без рыцаря $A$.

        В любом из этих двух подходов вам понадобится воспользоваться результатами задачи "[Потехе время, а работе час](task:random-schedule)".
    solution: |
        ### Решение "по кругу"

        Первого рыцаря можно выбрать $12$-ю способами.

        Вне зависимости от выбранного первого рыцаря нам нужно выбрать (без разницы в каком порядке) еще $4$ рыцаря, **НО**:

        * $1$ рыцаря мы только чтобы выбрали.
        * Ее $2$-е его соседей нельзя выбирать, ведь они противники уже выбранного рыцаря.
        * Между каждыми из $4$ рыцарей обязательно должен быть "пробел", чтобы не взять противников. Всего $3$ "пробела". (см. решение "[Потехе время, а работе час](task:random-schedule)")

        Поэтому выбрать оставшихся $4$ рыцарей можно $C_{12 - 1 - 2 -3}^4 = C_6^4$ способами.

        Используем правило умножения:

        $$ 12 \cdot C_{12-3-3}^4 $$

        Но среди этих способов есть дубликаты.
        Каждый отряд можно построить $5$-ю способами, потому что строить его можно начать с любого из пяти рыцарей в отряде.
        Раз каждый отряд представлен в виде $5$-ти дубликатов, то все способы надо разделить на $5$:

        $$ \frac{1}{5} \cdot 12 \cdot C_{6}^4 = 36 $$

        ### Решение "в ряд"

        Возьмем какого-нибудь произвольного рыцаря и назовем его $A$.
        Будем рассматривать два класса:

        1. Все способы собрать отряд вместе с рыцарем $A$
        2. Все способы собрать отряд без рыцаря $A$

        В классе с рыцарем $A$ мы круг по сути разорвали круг и выстроили рыцарей в ряд, начиная с $A$:

        $$ A \boxtimes \underbrace{\square \ \square \ \square \ \ldots}_{\text{9 рыцарей}} \ \boxtimes $$

        В этом классе нужно выбрать $4$  рыцаря из $9$, но между рыцарями обязательно должен быть как минимум один промежуток, значит суммарно $3$ промежутка между $4$ рыцарями:

        $$ C_{9-3}^4 = C_6^4 $$

        За пояснениями про промежутки и построение подобных сочетаний смотрите решение задачи "[Потехе время, а работе час](task:random-schedule)".

        В классе без рыцаря $A$ осталось $11$ рыцарей, которых теперь тоже можно выстроить в ряд:

        $$ \underbrace{\square \ \square \ \square \ \ldots}_{\text{11 рыцарей}} $$

        Среди них надо выбрать $5$ рыцарей, но тоже с обязательным минимальным разрывом в одного рыцаря, то есть с $4$ пропусками:

        $$ C_{11-4}^5 = C_7^5 $$

        Так как классы с рыцарем $A$ и без него не пересекаются, можно использовать [правило суммы](^sumRule) и найти все способы собрать отряд из $5$ рыцарей:

        $$ \underbrace{C_6^4}_{С \ A} + \underbrace{C_7^5}_{Без \ А} = 36 $$
    answer: $36$
    similar:
        -   statement: |
                Пускай при тех же условиях за столом сидят уже $n$ рыцарей короля Артура.
                Сколькими способами из них можно собрать отряд из $k$ рыцарей?
            hint: |
                Повторите варианты решения "по кругу" и "в ряд" просто уже с буквами, а не числами.
            answer: |
                Через решение "по кругу":

                $$ \frac{n}{k} C_{n-k-1}^{k-1} $$

                Через решение "в ряд":

                $$ C_{n-k-1}^{k-1} + C_{n-k}^k $$

@task
    title: Каркасные треугольники
    statement: |
        Сколько существует треугольников, вершины которых совпадают с вершинами данного выпуклого $n$-угольника, но стороны не совпадают со сторонами этого $n$-угольника?
    hint: |
        Это задача -- частный случай [задачи](task:knights) о рыцарях короля Артура, только в этот раз всего рыцарей $n$, а выбираем из них мы $3$.
        Найдите, сколько останется доступных для выбора вершин после выбора любой первой вершины треугольника.
    solution: |
        Все дейсвтия точно такие же, как и при решении [задачи](task:knights) о рыцарях короля Артура, только в этот раз всего рыцарей $n$, а выбираем из них мы $3$.

        ### Решение "по кругу"

        $$ \frac{1}{3}nC_{n-4}^2 $$

        ### Решение "в ряд"

        $$ C_{n-4}^2 + C_{n-3}^3 $$

    answer: |
        $$ \frac{1}{3}nC_{n-4}^2 = C_{n-4}^2 + C_{n-3}^3 $$

@task
    title: В тесноте, да не в обиде
    statement: |
        Сколько максимум может быть вершин у $k$-угольника, построенного "внутри" на вершинах данного выпуклого $n$-угольника и не имеющего с ним общих сторон?
    hint: |
        Посчитайте, сколько вершин $n$-угольника нужно задействовать для построения $k$-угольника.
    solution: |
        Какой $k$-угольник не возьми (выпуклый или невыпуклый) после каждой из $k$ вершин обязательно должен идти пропуск следующей соседней вершины, иначе возникнет общая сторона.

        Таким образом для построения $k$-угольника нам необходимо $k$ вершин самого $k$-угольника и еще $k$ нетронутых вершин.
        И в сумме это должно быть не больше имеющихся в распоряжении $n$ вершин $n$-угольника:

        $$ k + k \leq n \\ 2k \leq n \\ k \leq \frac{n}{2} $$

        Так как $k$ это целое число, то его максимум это целая часть от $\frac{n}{2}$:

        $$ \max(k) = \floor{\frac{n}{2}} $$
    answer: |
        $$ \floor{\frac{n}{2}} $$

@task
    title: Превосходство гласных
    statement: |
        Сколькими способами можно переставлять буквы в слове *"фацетия"* так, чтобы не менялся порядок гласных букв?
        А в слове *"параллелизм"*?
    hint: |
        Выпишите только гласные и найдите количество способов выбрать между и по бокам от них места под слагаемые.
        Заполните эти места слагаемыми.
    solution: |
        Выпишем только гласные слова "фацетия", а вакантные места для согласных будем отмечать цифрами в квадратах:

        $$ \boxed1 \ а \ \boxed2 \ е \ \boxed3 \ и \ \boxed4 \ я \ \boxed5 $$

        Всего $5$ вакантных мест.
        Нам нужно выбрать из них $3$ места под слагаемые, причем места могут повторятся, но их порядок значения не имеет.
        Количество способов это сделать можно посчитать по [формуле](^combinationsRepeat) сочетаний с повторениями: $\bar{C}_5^3$.

        Позиции для слагаемых мы выбрали.
        Вне зависимости от выбранных позиций три слагаемых по ним мы можем разместить $P_3$ способами.
        Используем правило умножения:

        $$ \bar{C}_5^3 P_3 = 210 $$

        Со словом "параллелизм" алгоритм точно такой же, вот только там некоторые слагаемые повторяются, поэтому надо использовать [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ \bar{C}_5^7 P(1,1,3,1,1) = 277 \ 200 $$
    answer: |
        Слово "фацетия":

        $$ \bar{C}_5^3 P_3 = 210 $$

        Слово "параллелизм":

        $$ \bar{C}_5^7 P(1,1,3,1,1) = 277 \ 200 $$

@task
    title: Неугомонный пастух
    statement: |
        Сколькими способами можно переставить буквы слова *"пастух"* так, чтобы между двумя гласными были две согласные буквы?
    hint: |
        Сначала найдите количество способов составить конструкцию "гссг", где "г" -- гласная, а "с" -- согласная.
        Затем встраивайте ее в итоговое слово.
    solution: |
        Согласно условию в итоговом слове должна обязательно присутствовать конструкция следующего вида:

        $$ г\ с \ с \ г $$

        Гласные по местам "г" можно разместить $P_2$ способами.
        Вне зависимости от размещения гласных, согласные по местам "с" можно разместить $A_4^2$ способами.
        По [правилу умножения](^productRule) находим все способы составить такую конструкцию:

        $$ P_2A_4^2 $$

        Это сочетание из $4$-х букв в итоговое слово можно встроить $3$-мя способами:

        $$ гссг \square \square \qquad \square гссг \square \qquad \square \square гссг  $$

        $$ 3\cdot P_2A_4^2 $$

        Наконец, оставшиеся два места можно заполнить двумя оставшимися согласными $P_2$ способами:

        $$ 3\cdot P_2A_4^2P_2 = 288 $$
    answer: $288$

@task
    title: Четные согласные
    statement: |
        Сколькими способами можно переставить буквы слова *"логарифм"* так, чтобы второе, четвертое и шестое места были заняты согласными буквами?
    hint: |
        Сначала поставьте три согласных на четные позиции, а затем расставьте все остальные буквы.
    solution: |
        Сначала разместим $3$ слагаемых из $5$ по четным позициям.
        Сделать это можно $A_5^3$ способами.
        Остальные $5$ букв расставляем по $5$ оставшимся в слове местам $P_5$ способами.

        Расстановка согласных никак не влияет на количество способов расставить остальные буквы, поэтому количество возможных составляемых слов можно найти по [правилу умножения](^productRule):

        $$ A_5^3 P_5 = 7200 $$
    answer: $7200$

@task
    title: Дикий огород
    statement: |
        Сколькими способами можно переставить буквы слова *"огород"* так, чтобы три буквы "о" не стояли рядом?
        А если запрещается, чтобы две буквы "о" стояли рядом?
    hint: |
        Для ответа на первый вопрос из всех способов расставить буквы нужно вычесть варианты с тройными "о".
        Для ответа на второй вопрос расставьте слагаемые и выберите "позиции" для букв "о".
    solution: |
        Всего буквы можно расставить $P(3,1,1,1)$ способами.
        Три согласные можно расставить $P_3$ способами и $4$ способа встроить между ними ($2$) и по бокам (еще $2$) "склеенную" тройку букв "о".
        Вычитаем из всех способов варианты с тройной "о":

        $$ P(3,1,1,1) - P_3 \cdot 4 = 96 $$

        Второй вопрос еще проще.
        Опять расставляем три согласные $P_3$ способами.
        Теперь для букв "о" нужно выбрать $3$ позиции из $4$-х имеющихся ($2$ между согласными и $2$ по бокам).
        Сделать это можно $C_4^3$ способами.
        
        Расстановка согласных никак не влият на способы выбрать позиции для букв "о", поэтому для нахождения всех способов можно использовать [правило умножения](^productRule):

        $$ P_3 C_4^3 = 24 $$
    answer: |
        $96$ способов без тройных "о" и $24$ без двойных "о".

@task
    title: Числовой Ад
    tags:
        - Объемная
        - Сложная
    statement: |
        Сколько пятизначных чисел можно составить из цифр числа $12 312 343$ так, чтобы три цифры $3$ не шли друг за другом?
    hint: |
        Все возможные пятизначные числа разбейте на группы по количеству одинаковых цифр в их записи.
        Например, группа $(2, 1, 1, 1)$ означает, что в пятизначном числе $2$ одинаковые цифры и $3$ уникальные (как в числе $11234$).

        Таких групп всего $7$:

        1. $ (1, 1, 1, 1, 1) $
        2. $ (2, 1, 1, 1) $
        3. $ (2, 2, 1) $
        4. $ (3, 1, 1) $
        5. $ (3, 2) $
        6. $ (4, 1) $
        7. $ (5) $

        Найдите количества пятизначных чисел в каждой из них.

        Потом из общего количества чисел вычтите количество чисел с тремя тройками.
    solution: |
        Сначала нам нужно найти, а сколько вообще можно составить из данных цифр пятизначных чисел.

        Для этого все возможные пятизначные числа разобьем на группы по количеству одинаковых цифр в их записи.
        Например, группа $(2, 1, 1, 1)$ означает, что в пятизначном числе $2$ одинаковые цифры и $3$ уникальные (как в числе $11234$).

        Найдем все группы:

        1. $ (1, 1, 1, 1, 1) $
        2. $ (2, 1, 1, 1) $
        3. $ (2, 2, 1) $
        4. $ (3, 1, 1) $
        5. $ (3, 2) $
        6. $ (4, 1) $
        7. $ (5) $

        Группа под номером $1$ пустая, так как у нас нет $5$ разных цифр.
        Так же пустыми являются группы под номерами $7$ и $6$, потому что у нас в распоряжении нет ни $5$, ни $4$ одинаковых цифр (у нас максимум три одинаковые цифры $3$).

        Выходит, все требуемые пятизначные числа можно разбить на $4$ группы:

        * $ (2, 1, 1, 1) $
        * $ (2, 2, 1) $
        * $ (3, 1, 1) $
        * $ (3, 2) $

        ### Подсчет чисел в группах

        Для удобства запишем имеющиеся цифры, расположив дубликаты рядом друг с другом:

        $$ 11 \qquad 22 \qquad 333 \qquad 4 $$

        Будем идти по порядку.
        Начнем с группы $(2, 1, 1, 1)$.
        Две одинаковые цифры можно взять либо из единиц, либо из двоек, либо из троек, то есть всего $3$ способа.

        Вне зависимости от выбранных двух одинаковых цифр построить пятизначное число можно $P(2,1,1,1)$ способами (две одинаковые цифры, и по одному экземпляру всех остальных цифр).
        По [правилу умножения](^productRule) находим количество чисел в группе $ (2, 1, 1, 1) $:

        $$ 3 \cdot P(2,1,1,1) $$

        Теперь группа $(2, 2, 1)$.
        Если единственной уникальной цифрой будет $4$, то по два дубликата можно взять $3$-мя способами ($1122$, $1133$, $2233$).
        Если уникальной цифрой выбрать $1$, $2$ или $3$, то в каждом из этих трех вариантов дубликаты [можно выбрать](spoiler:duplicate-explain) единственным способом.
        Получается следующая ситуация:

        $$ \underbrace{3\cdot P(2,2,1)}_{\text{4 - уник.}} + \underbrace{1\cdot P(2,2,1)}_{\text{3 - уник.}} + \underbrace{1\cdot P(2,2,1)}_{\text{2 - уник.}} + \underbrace{1\cdot P(2,2,1)}_{\text{1 - уник.}} = \\ = 6 \cdot P(2,2,1) $$

        { #duplicate-explain }
        @spoiler
            Например, если в качестве уникальной цифры взять цифру $3$, то дубликаты можно выбрать только одним способом: $1122$.
            Такая же ситуация, если в качестве уникальный цифры взять $2$ или $1$.

        Теперь группа $ (3, 1, 1) $.
        Тут три дубликата можно взять только тройками.
        А вот $2$ разные цифры можно выбрать тремя способами ($12$, $14$, $24$).
        По правилу умножения находим количество пятизначных чисел в этой группе:

        $$ 3\cdot P(3,1,1) $$

        Наконец, группа $(3,2)$.
        Опять же, три дубликата можно взять только тройками.
        А вот два других дубликата можно взять двумя способами ($11$, $22$).

        $$ 2\cdot P(3,2) $$

        ### Количество пятизначных чисел

        Наши группы не пересекаются, потому что состоят из разных групп дубликатов в разных количествах.
        Поэтому мы можем по [правилу сложения](^sumRule) сложить количество чисел во всех этих группах и найти общее количество пятизначных чисел:

        $$ 3\cdot P(2,1,1,1) + 6\cdot P(2,2,1) + 3\cdot P(3,1,1) + 2\cdot P(3,2) $$

        Для выражений с $P$ используем [формулу](^permutationsRepeat) перестановок с повторениями:

        $$ 3 \cdot \frac{5!}{2!} + 6\cdot \frac{5!}{2! \ 2!} + 3\cdot \frac{5!}{3!} + 2\cdot\frac{5!}{3! \ 2!} = 440 $$

        ### Количество чисел с тремя тройками

        Найдем количество чисел с тремя тройками.
        Пускай у нас уже есть три цифры $3$ в числе.
        Осталось расположить еще две цифры.
        Расположить их можно либо по бокам, либо обе до, либо обе после -- всего $3$ варианта.

        Прямым перебором в порядке возрастания перечислим все возможные варианты занять эти два места:

        $$ 11,\ 12,\ 14,\ 21,\ 22,\ 24,\ 41,\ 42 $$

        Всего $8$ способов заполнит два места и $3$ возможных расопложения этих двух мест.
        То есть чисел с тремя тройками всего $3\cdot 8 = 24$.

        ### Ответ на задачу

        Вычитаем из количества всех пятизначных чисел числа с тремя тройками:

        $$ 440 = 24 = 416 $$
    answer: $416$
    similar:
        -   statement: |
                Сколько четырехзначных чисел можно составить из цифр числа $123 \ 153$?
            answer: $102$

        -   statement: |
                Сколько пятизначных чисел можно составить из цифр числа $12 \ 335 \ 233$?
            answer: $265$